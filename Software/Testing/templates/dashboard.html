{% extends "layout.html" %}
{% block title %}Dashboard{% endblock title %}
{% block body %}

<h2>Dashboard</h2>
<h6>Current login: {{ session['username'] }}</h6>
<hr>
<a name="addResident" class="btn btn-danger" href="/dashboard/addResident" role="button">Add Resident</a>
<hr>
{% if last4Logs %} 
<h3>Logs</h3>
<hr>
<table class="table table-hover">
    <thead>
      <tr>
        <th scope="col">Resident</th>
        <th scope="col">Room Number</th>
        <th scope="col">Laundry Room Number</th>
        <th scope="col">Laundry Type</th>
        <th scope="col">Timer</th>
        <th scope="col">Status</th>
      </tr>
    </thead>
    <tbody>
        {% for log in last4Logs %}
        <tr>   
          <td>{{ log['fullname'] }}</td>
          <td>{{ log['roomNum'] }}</td>
          <td>{{ log['laundryNum'] }}</td>
          <td>{{ log['laundryType'] }}</td>
          <td>
            <span id="timer"></span>
          </td>
          <td>
            
              <div class="form-check form-switch">
                <form action="post">
                  <input class="form-check-input" id="switch" type="checkbox" name="startPauseToggle" value="Start">
                  <label class="form-check-label" for="flexSwitchCheckDefault">Start/Pause</label> 
                </form>
              </div>
            </form> 
          </td>
        {% endfor %}
      
    </tbody>
{% else %}
<div class="alert alert-danger">There are no logs.</div>
{% endif %}

<script type="application/javascript">
  const timer = document.getElementById('timer');
  const switchBtn = document.getElementById('switch');

  var totalTime = 10; //! Get this value from outside
  var count = 0;
  
  const displayTime = (totalTime) => {
    timer.innerHTML = totalTime;
  }

  displayTime(totalTime);

  const isPositive = (number) => {
      return 1/(number * 10) === 1/0;
  } 

  switchBtn.addEventListener('change', e => {
      if (e.target.checked === true)
      { 
        switchBtn.disabled = true; 
        var countDown = setInterval(() => {
            if (totalTime <= 0)
            {
              switchBtn.disabled = false; 
              alert("Time finished");
              totalTime = 10;
              clearInterval(countDown);
              switchBtn.checked = false; 
              timer.innerHTML = totalTime;                         
            }
            else
            {
                totalTime--;
                timer.innerHTML = totalTime;   
            }
       
        }, 1000);
        countDown;
      }

  });
  
</script>

{% endblock body %}